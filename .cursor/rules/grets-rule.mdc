---
description: 
globs: 
alwaysApply: true
---
**以下为GRETS系统的交易流程，请你的后续的开发中严格按照该逻辑对代码进行开发**

# 技术栈
- 前端：Vue3 + TypeScript + Element-Plus(根目录路径: /application/web)
- 后端：Golang 1.24(根目录路径: /application/server，地址为localhost:8080)
- 智能合约：Golang 1.23(根目录路径: /chaincode)
- 区块链工具：hyperledger fabric 2.5(根目录路径: /network)
- 链下信息存储：Mysql、ipfs

# 设计要求
- 本项目的设计和数据存储需要尽可能发挥区块链以及hyperledger fabric的特性
- 尽可能对隐私信息进行保护，对需要多方共识的数据进行上链操作
- 尽可能做到智能合约的热升级
- 尽可能做到特定功能模块的热插拔功能

# 业务逻辑
## 用户相关
- 同一个身份证号的用户可以在多个组织分别注册账号，但（身份证号，组织）为唯一存在
- 用户在登录界面可以选择使用什么组织进行登录
- 只有投资者组织需要在注册的时候传入自己的注册资金数量
- 注册操作需要上链
- 用户登录之后能够看到自己身份可见的页面
- 每个组织能够看见的页面内容不同
- 政府部门(government)能够查看房产列表、新增或修改（正常、冻结、抵押）房产、查看交易列表等
- 投资者(investor)能够查看房产列表、修改（正常、交易）房产、创建或修改交易、创建支付、一对一聊天室聊天等
- 银行(bank)可以查看交易列表、支付列表
- 审计部门(audit)能够查看房产列表、交易列表以及每一笔交易的合同，能够修改（正常、冻结）房产和交易的状态（是否冻结）

## 房产相关(realty)
- 房产信息只能由政府部门进行登记创建
- 政府登记创建后的房产为**新房**，持有人为政府，身份证号为GovernmentDefault字符串（创建房产的时候强制自动填入），手机为18917950960，邮箱为18917950960@163.com
- 登记新房的时候，如果设置状态为**正常**，则必须同时选择一份合同，供投资者直接进行交易；否则默认新房的状态为抵押状态
- 如果房产持有人的身份证号不为政府，则该房产为**二手房**
- 政府组织只有一个账户，也只有一个身份证号、手机和邮箱
- 在房产被登记创建之后，投资者可以通过房产列表查看目前所有房产的状态
- 通过点击房产列表中的数据，投资者可以进入查看该房产的具体信息（包括该房产的历史交易记录，以抽屉形式隐藏于页面的右侧），房产持有人的相关信息（如身份证号、电话、邮箱）做哈希处理，但新房的持有人不需要隐私保护（也就是直接显示"政府"两个字）
- 在房产详情界面，非持有人的投资者可以提出私聊申请
- 投资者提出私聊申请之前需要进行验资，如果投资者想要购买**二手房**，则验资成功后获取进入以该房产为维度的一对一聊天室的权限，能够与房产持有人进行单独私聊。如果投资者想要购买**新房**，则不需要私聊，能够通过政府提供好的的合同，直接开始交易
- 政府能够修改任意房产的状态（被抵押、被冻结、正常）、房产类型（住宅、商铺、办公、工业、其他）
- 房产持有者能够修改自己名下的房产的状态（正常、交易中）、参考价格、描述、图片、关联合同（可以为空）
- 房产的创建和编辑操作需要上链

## 合同相关(contract)
- 在开始每一笔交易之前，买卖双方需要确定该笔交易唯一的合同
- 交易完成之后，合同状态修改为已结束
- 合同内容保存在MySQL中（后续考虑将具体内容保存在IPFS中，MySQL保存哈希值）
- 合同当且仅当在创建交易的时候与交易的uuid绑定，并且后续不允许修改

## 支付相关(payment)
- 用户在发起交易之后可以进行支付操作
- 一笔支付需要绑定双方的身份证号和具体金额
- 支付操作需要上链

## 交易相关(transaction)
- 买卖双方都可以以房产为维度发起交易，一笔交易必须绑定双方的身份证号、房产证号、合同的UUID、交易价格、税费、交易预计结束时间
- 交易的合同为与该房产关联的合同，可以由房产持有人修改
- 一笔交易可以有一次或多次支付，当累计的支付金额达到交易价格后，交易自动结束，并且退回买方多支付的金额
- 当买方在交易预计结束时间时，累计支付的总额没有达到交易价格，则交易结束，但不退回买方过去已经支付的金额
- 交易的创建、结束、更新（买方的每一次支付所导致的更新）需要上链

## 聊天室相关(chatRoom)
- 买方进入聊天室后，能够查看卖方的具体信息（没有被哈希处理过）
- 一对一聊天室支持发送接收文件
- 投资者可以同时开启多个聊天室
- 交易结束之后，聊天室解除，但聊天记录保存在链下数据库中，供审计查看
